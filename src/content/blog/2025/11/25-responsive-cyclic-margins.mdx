---
title: 'Responsive Cyclic Margins'
fancyTitle: true
description: 'The title ofÂ this post might not seem like aÂ big deal, but the problem IÂ will talk about was pretty fun toÂ work out: how doÂ you make aÂ margin between elements responsive based onÂ the available space inÂ their parent, and such that itÂ does not collapse inÂ aÂ `min-content` context?'
tags: ['Obscure CSS', 'CSS']
pubDate: '2025-11-25'
mastodonPostId: '115612725378654218'

current: {
	drink: 'Infusion of hibiscus, apples, rosehip, and orange peels, with cherry flavor.',
	music: 'Mitski â€”Â Pearl Diver',
}

bandcamp: {
	track: '2255289821',
	link: 'https://mitski.bandcamp.com/track/pearl-diver',
}
---

import LiveExample from '@components/LiveExample.astro';

The title ofÂ this post mightÂ not seem like aÂ big deal, but the problem IÂ will talk about was pretty fun toÂ work out: how doÂ you make aÂ margin between elements responsive based onÂ the available space inÂ their parent, and such that itÂ does not collapse inÂ aÂ `min-content` context?

## Table of Contents

## The Problem

That might seem toÂ beÂ pretty specific, but letâ€™s say weÂ have anÂ element with two parts like aÂ button, with the text disappearing when there isÂ not enough space:

<div class="aside-wrapper" style="--span: 2">
<aside>
IÂ wonâ€™t touch onÂ ifÂ using ellipsis inÂ cases like this one isÂ aÂ good idea. InÂ anÂ ideal world, you would have aÂ better content strategy, but inÂ Hellâ€¦
</aside>
</div>

<LiveExample isScoped="example" shouldHideCSS>
```HTML
<p>
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon">ğŸŒ</span>
	</button>
</p>
<p style="width: 42px">
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon">ğŸŒ</span>
	</button>
</p>
```
```CSS
p {
	overflow: hidden;
	resize: horizontal;
	outline: 1px solid var(--PINK);
	padding: 1em;
	width: min-content;
}

button {
	--border: 1px;
	--padding: 8px;
	--icon-size: 1em;
	--min-width: calc(
		var(--icon-size)
		+
		2 * var(--border)
		+
		2 * var(--padding)
	);
	display: inline-flex;
	max-width: 100%;
	min-width: var(--min-width);
	padding: 0 var(--padding);
	border: var(--border) solid var(--GREEN);
	background: var(--CONTENT-BG);
	border-radius: 1lh;
	font: inherit;
	cursor: pointer;
}

.ellipsis {
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
}
.icon {
	display: inline-block;
	width: var(--icon-size);
	text-align: center;
	flex-shrink: 0;
}
```
</LiveExample>

What weÂ want isÂ toÂ add aÂ margin between the text and icon here, but make itÂ disappear when the button collapses.

Any static margin added toÂ either span there will beÂ still there when weÂ collapse the button toÂ beÂ narrower than the available space:

<LiveExample isScoped="example" shouldHideHTML caption="Expanding the resizable blocks will show the margin between the text and its icon.">
```HTML
<p style="width: 42px;">
	<button type="button">
		<span class="ellipsis with-margin">Hello, world!</span>
		<span class="icon">ğŸŒ</span>
	</button>
</p>
<p style="width: 42px">
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon with-margin">ğŸŒ</span>
	</button>
</p>
```
```CSS
.ellipsis.with-margin {
	margin-right: 0.5em;
}
.icon.with-margin {
	margin-left: 0.5em;
}
```
</LiveExample>

And, because our buttons has toÂ shrink toÂ fit its contents, weÂ canâ€™t use `inline-size` containment and size the margin via container query length units. So, what toÂ do?

## An Attempt

You could think: hey, weÂ can use `%` inÂ CSS, which will beÂ evaluated based onÂ the width ofÂ the parent elementâ€¦ Could weÂ use itÂ inÂ some way, like with aÂ calculation?


<LiveExample isScoped="example" shouldHideHTML>
```HTML
<p>
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon with-naive-percentage">ğŸŒ</span>
	</button>
</p>
<p style="width: 42px">
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon with-naive-percentage">ğŸŒ</span>
	</button>
</p>
```
```CSS
.icon.with-naive-percentage {
	margin-left: clamp(
		0px,
		100% - var(--min-width),
		0.5em
	);
}
```
</LiveExample>

ItÂ seems toÂ worâ€” ohÂ wait, why isÂ there anÂ ellipsis? And even when weÂ expand our resizable paragraph, itÂ stays this way?

What weÂ attempted toÂ doÂ isÂ toÂ make itÂ soÂ weÂ will have aÂ margin that depends onÂ the parentâ€™s width, and goes from `0.5em` toÂ `0px`. ByÂ subtracting the `--min-width` variable weÂ can make itÂ goÂ toÂ zero when approaching that min-width.

And itÂ kinda works: when itÂ isÂ narrow, there isÂ noÂ margin, when itÂ isÂ wider â€” margin appears, but something breaks.

## Percentage Evaluation

The answer toÂ what isÂ happening â€” why weÂ have the text truncated even though itÂ seems like weÂ should have space available, lies inÂ the [â€œIntrinsic Contributions ofÂ Percentage-Sized Boxesâ€](https://drafts.csswg.org/css-sizing-3/#cyclic-percentage-contribution) section ofÂ the [â€œCSS Box Sizing Module Level 3â€](https://drafts.csswg.org/css-sizing-3/) spec, specifically the [paragraph â€œd.â€](https://drafts.csswg.org/css-sizing-3/#min-percentage-contribution):

> [â€¦] for margins and paddings (and gutters), a cyclic percentage is resolved against zero for determining intrinsic size contributions.

Because the button shrunks toÂ its max-content width when itÂ isÂ `inline-â€¦`, this width isÂ calculated byÂ adding upÂ all the childrensâ€™s contibutions, and for our `margin` weÂ substitute any `%` inside with `0`. So, for calculating this width, the following:

```CSS
margin-left: clamp(
	0px,
	100% - var(--min-width),
	0.5em
);
```

Can be treated as

```CSS
margin-left: clamp(
	0px,
	0px - var(--min-width),
	0.5em
);
```

And soÂ itÂ will become just `0px`, soÂ the total width ofÂ the whole button will consist ofÂ its borders, paddings, text content, and the icon. Plus zero for our margin.

Then, knowing this width, weÂ start toÂ layout everything inside, and according toÂ our formula the `margin` becomes `0.5em` asÂ the width isÂ quite largeâ€¦ but that _reduces_ the space available for our text, soÂ itÂ becomes truncated!

## The Solution?

ToÂ solve this, weÂ can _introduce even more percentages_ but inÂ reverse!

<LiveExample isScoped="example" shouldHideHTML caption="No unnecessary truncation in sight! Unless you look at this in Safari.">
```HTML
<p>
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon with-percentage">ğŸŒ</span>
	</button>
</p>
<p style="width: 42px">
	<button type="button">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon with-percentage">ğŸŒ</span>
	</button>
</p>
```
```CSS
.icon.with-percentage {
	--margin: 0.5em;
	margin-left: clamp(
		max(0px, var(--margin) - 100%)
		,
		100% - var(--min-width)
		,
		var(--margin)
	);
}
```
</LiveExample>

Now itÂ works! When wide â€” without collapsing â€”Â the margin isÂ `0.5em`, when narrow â€” itÂ isÂ zero.

What weÂ did isÂ replaced the lower boundary ofÂ our `clamp()` with aÂ `max()` that, when considered inÂ aÂ _cyclic percentage context_ results inÂ `0.5em`, and otherwise results inÂ `0px`. Whoa!

## â€¦Except for the Safari Bug

Ooops. Thatâ€™s what happens when you test out anÂ obscure place inÂ CSS, and check how itÂ behaves inÂ different browsers. Instead ofÂ only evaluating the `%` asÂ zero, Safari just throws the whole calculation away and replaces the whole _margin_ with zero T_T

<LiveExample isScoped>
```HTML
<p>
	<button type="button">
		<span>button</span>
	</button>
</p>
```
```CSS
button > span {
	margin: calc(0% + 50px);
}
```
</LiveExample>

Safari renders this example not asÂ you would expectâ€¦ OfÂ course, IÂ [opened aÂ bug](https://bugs.webkit.org/show_bug.cgi?id=303109) about this.

## The Working Solution

Right after IÂ published this post, IÂ suddenly decided toÂ test what will happen if, instead ofÂ aÂ margin, weÂ would use aÂ `gap`? **It works! **

<LiveExample isScoped="example" shouldHideHTML caption="No unnecessary truncation in sight! Even in Safari!">
```HTML
<p>
	<button type="button" class="with-gap">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon">ğŸŒ</span>
	</button>
</p>
<p style="width: 42px">
	<button type="button" class="with-gap">
		<span class="ellipsis">Hello, world!</span>
		<span class="icon">ğŸŒ</span>
	</button>
</p>
```
```CSS
.with-gap {
	--gap: 0.5em;
	gap: clamp(
		max(0px, var(--gap) - 100%)
		,
		100% - var(--min-width)
		,
		var(--gap)
	);
}
```
</LiveExample>

So, this isÂ the solution IÂ will recommend: instead ofÂ aÂ `margin`, use aÂ `gap`, with the rest ofÂ our calculations remaining inÂ place: without the negative cyclic percentage condition the button would still collapse, but now the `gap` works the same inÂ all browsers â€” likely because itÂ was implemented later than `margin`. Ooof.

## Conclusion

Not always you stumble over aÂ _cyclic percentage_ issues, and not always you can overcome them byÂ exploiting the same substitution toÂ zero with conditional calculations.

IÂ feel this isÂ just aÂ glimpse ofÂ what these kinds ofÂ calculations could achieve, and IÂ invite you toÂ also try and hack any similar places inÂ the sameÂ way. Maybe youâ€™ll stumble over something funÂ too!
